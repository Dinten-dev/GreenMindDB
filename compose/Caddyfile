{
    auto_https disable_redirects
}

{$GREENMIND_DOMAIN} {
    tls {$CADDY_TLS_MODE}
    encode zstd gzip

    @grafana path /grafana* 
    handle @grafana {
        reverse_proxy grafana:3000
    }

    handle {
        reverse_proxy {$API_UPSTREAM}
    }

    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        Referrer-Policy strict-origin-when-cross-origin
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
    }

    log {
        output stdout
        format json
    }
}
